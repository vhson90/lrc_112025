<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh To√°n V√© LRC - QR Code</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 10px;
        }
        h3 { 
            margin-top: 5px;
            margin-bottom: 5px;
            font-size: 1em; 
            font-weight: bold;
        }
        .ticket-form { 
            background: #f9f9f9; 
            padding: 15px;
            border-radius: 8px; 
        }
        .ticket-group { 
            border: 1px solid #ddd; 
            padding: 10px;
            margin-bottom: 20px; 
            border-radius: 6px; 
        }
        label, select, input, button { 
            display: block; 
            margin-bottom: 15px; 
            width: 100%; 
            box-sizing: border-box; 
        }
        input[type="text"], input[type="number"], select { 
            padding: 10px; 
            font-size: 16px;
            border: 1px solid #ccc; 
            border-radius: 4px; 
        }
        button { 
            background-color: #007bff; 
            color: white; 
            padding: 12px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 18px; 
            margin-top: 20px; 
        }
        button:hover { 
            background-color: #0056b3; 
        }
        #qr-container { 
            text-align: center; 
            margin-top: 30px; 
            border: 1px solid #eee; 
            padding: 20px; 
            border-radius: 8px; 
        }
        #qr-container img {
            max-width: 90%;
            height: auto;
            width: 300px; 
        }
        #total-amount { 
            font-size: 1.5em; 
            font-weight: bold; 
            color: #28a745; 
            margin-bottom: 15px; 
        }
        #explanation {
            font-size: 0.95em;
            text-align: center;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
            margin-top: 15px;
        }
        .error { color: red; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1>üí∞ Thanh To√°n V√© LRC</h1>
    <hr>
    
    <div class="ticket-form">
        <h2>Th√¥ng tin ƒë·∫∑t v√© v√† ng∆∞·ªùi chuy·ªÉn</h2>

        <label for="name">H·ªç t√™n Lƒê Platinum UP:</label>
        <input type="text" id="name" placeholder="V√≠ d·ª•: NGUYEN VAN A">
        
        <label for="transport_mode">H√¨nh th·ª©c ƒêƒÉng k√Ω:</label>
        <select id="transport_mode">
            <option value="group_only">Ch·ªâ ƒëi theo ƒëo√†n</option>
            <option value="self_only">Ch·ªâ ƒëi t·ª± t√∫c</option>
            <option value="combined">K·∫øt h·ª£p theo ƒëo√†n v√† t·ª± t√∫c</option>
        </select>

        <div id="group-form" class="ticket-group">
            <h3>V√© THEO ƒêO√ÄN</h3>
            <label for="group_adults">S·ªë l∆∞·ª£ng Ng∆∞·ªùi l·ªõn (ƒêo√†n):</label>
            <input type="number" id="group_adults" value="0" min="0">

            <label for="group_children_6_10">S·ªë l∆∞·ª£ng Tr·∫ª em (ƒêo√†n, 6-10 tu·ªïi):</label>
            <input type="number" id="group_children_6_10" value="0" min="0">

            <label for="group_children_1_5">S·ªë l∆∞·ª£ng Tr·∫ª em ƒëi k√®m (ƒêo√†n, 1-5 tu·ªïi):</label>
            <input type="number" id="group_children_1_5" value="0" min="0">
        </div>

        <div id="self-form" class="ticket-group" style="display:none;">
            <h3>V√© T·ª∞ T√öC</h3>
            <label for="self_adults">S·ªë l∆∞·ª£ng Ng∆∞·ªùi l·ªõn (T·ª± t√∫c):</label>
            <input type="number" id="self_adults" value="0" min="0">

            <label for="self_children_6_10">S·ªë l∆∞·ª£ng Tr·∫ª em (T·ª± t√∫c, 6-10 tu·ªïi):</label>
            <input type="number" id="self_children_6_10" value="0" min="0">

            <label for="self_children_1_5">S·ªë l∆∞·ª£ng Tr·∫ª em ƒëi k√®m (T·ª± t√∫c, 1-5 tu·ªïi):</label>
            <input type="number" id="self_children_1_5" value="0" min="0">
        </div>
        
        <div id="total-amount">T·ªïng ti·ªÅn: 0 VND</div>
        
        <button onclick="generateQrCode()">Hi·ªán M√£ QR Thanh To√°n</button>
    </div>

    <div id="qr-container">
        <p>Vui l√≤ng ch·ªçn th√¥ng tin v√© v√† nh·∫•n n√∫t ƒë·ªÉ t·∫°o m√£ QR.</p>
    </div>

    <script>
        // --- D·ªØ li·ªáu gi√° v√© (ƒê√£ chuy·ªÉn ƒë·ªïi t·ª´ k sang VND) ---
        const TICKET_PRICES = {
            group: {
                adult: 1700000,
                child_6_10: 1200000,
                child_1_5: 200000 
            },
            self: {
                adult: 1500000,
                child_6_10: 1000000,
                child_1_5: 0 
            }
        };

        // --- H√†m x·ª≠ l√Ω chu·ªói: Lo·∫°i b·ªè d·∫•u, vi·∫øt hoa, v√† chu·∫©n h√≥a k√Ω t·ª± ---
        function cleanVietnameseString(str) {
            if (!str) return '';
            
            str = str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase();
            str = str.replace(/[^A-Z0-9\s]/g, ' ');
            
            return str.replace(/\s+/g, ' ').trim();
        }

        // --- H√†m hi·ªÉn th·ªã form t√πy theo h√¨nh th·ª©c ƒëƒÉng k√Ω ---
        function toggleForms() {
            const mode = document.getElementById('transport_mode').value;
            document.getElementById('group-form').style.display = (mode === 'group_only' || mode === 'combined') ? 'block' : 'none';
            document.getElementById('self-form').style.display = (mode === 'self_only' || mode === 'combined') ? 'block' : 'none';
            
            calculateTotal(); 
        }

        // --- H√†m t√≠nh to√°n v√† c·∫≠p nh·∫≠t t·ªïng ti·ªÅn ---
        function calculateTotal() {
            const mode = document.getElementById('transport_mode').value;
            let total = 0;
            let tickets = {};

            if (mode === 'group_only' || mode === 'combined') {
                const ga = parseInt(document.getElementById('group_adults').value) || 0;
                const gc610 = parseInt(document.getElementById('group_children_6_10').value) || 0;
                const gc15 = parseInt(document.getElementById('group_children_1_5').value) || 0;
                
                if (ga < 0 || gc610 < 0 || gc15 < 0) return;
                
                total += (ga * TICKET_PRICES.group.adult) + 
                         (gc610 * TICKET_PRICES.group.child_6_10) + 
                         (gc15 * TICKET_PRICES.group.child_1_5);
                
                tickets.group = { adults: ga, c610: gc610, c15: gc15 };
            }

            if (mode === 'self_only' || mode === 'combined') {
                const sa = parseInt(document.getElementById('self_adults').value) || 0;
                const sc610 = parseInt(document.getElementById('self_children_6_10').value) || 0;
                const sc15 = parseInt(document.getElementById('self_children_1_5').value) || 0;

                if (sa < 0 || sc610 < 0 || sc15 < 0) return;

                total += (sa * TICKET_PRICES.self.adult) + 
                         (sc610 * TICKET_PRICES.self.child_6_10) + 
                         (sc15 * TICKET_PRICES.self.child_1_5);

                tickets.self = { adults: sa, c610: sc610, c15: sc15 };
            }

            const totalDisplay = document.getElementById('total-amount');
            totalDisplay.innerHTML = `T·ªïng ti·ªÅn: ${total.toLocaleString('vi-VN')} VND`;
            totalDisplay.dataset.amount = total; 
            totalDisplay.dataset.tickets = JSON.stringify(tickets);
        }

        // --- H√†m t·∫°o URL m√£ QR v√† hi·ªÉn th·ªã ---
        function generateQrCode() {
            calculateTotal(); 

            const totalAmount = document.getElementById('total-amount').dataset.amount;
            const nameInput = document.getElementById('name').value.trim();
            const tickets = JSON.parse(document.getElementById('total-amount').dataset.tickets || '{}');
            
            const qrContainer = document.getElementById('qr-container');

            if (nameInput === "") {
                qrContainer.innerHTML = '<p class="error">‚ö†Ô∏è Vui l√≤ng nh·∫≠p **H·ªç t√™n Lƒê Platinum UP** ƒë·ªÉ t·∫°o m√£ QR.</p>';
                return;
            }
            if (totalAmount == 0) {
                qrContainer.innerHTML = '<p class="error">‚ö†Ô∏è Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt v√©.</p>';
                return;
            }

            // 1. Chu·∫©n h√≥a T√™n ng∆∞·ªùi chuy·ªÉn
            const cleanName = cleanVietnameseString(nameInput);
            let descriptionParts = [cleanName];
            
            // 2. Th√™m chi ti·∫øt v√© (V√© ƒêo√†n)
            if (tickets.group && (tickets.group.adults > 0 || tickets.group.c610 > 0 || tickets.group.c15 > 0)) {
                let groupDetails = ['VeDoan'];
                if (tickets.group.adults > 0) groupDetails.push(`${tickets.group.adults}NL`);
                if (tickets.group.c610 > 0) groupDetails.push(`${tickets.group.c610}TE`);
                if (tickets.group.c15 > 0) groupDetails.push(`${tickets.group.c15}DK`); 
                
                descriptionParts.push(groupDetails.join(' '));
            }
            
            // 3. Th√™m chi ti·∫øt v√© (V√© T·ª± T√∫c)
            if (tickets.self && (tickets.self.adults > 0 || tickets.self.c610 > 0 || tickets.self.c15 > 0)) {
                let selfDetails = ['TuTuc'];
                if (tickets.self.adults > 0) selfDetails.push(`${tickets.self.adults}NL`);
                if (tickets.self.c610 > 0) selfDetails.push(`${tickets.self.c610}TE`);
                if (tickets.self.c15 > 0) selfDetails.push(`${tickets.self.c15}DK`); 
                
                descriptionParts.push(selfDetails.join(' '));
            }

            // N·ªôi dung chuy·ªÉn ti·ªÅn hi·ªÉn th·ªã (S·ª≠ d·ª•ng D·∫§U C√ÅCH gi·ªØa t·∫•t c·∫£ c√°c n·ªôi dung)
            const finalDescription = descriptionParts.join(' '); 

            // Chu·∫©n b·ªã cho URL: Thay t·∫•t c·∫£ kho·∫£ng tr·∫Øng ' ' b·∫±ng d·∫•u '+' theo y√™u c·∫ßu c·ªßa Sepay.vn
            const encodedDescription = finalDescription.replace(/\s/g, '+');


            // URL t·∫°o m√£ QR
            const qrUrl = `https://qr.sepay.vn/img?bank=VietinBank&acc=NHILE88&template=compact&amount=${totalAmount}&des=${encodedDescription}`;

            // T·∫°o n·ªôi dung gi·∫£i th√≠ch vi·∫øt t·∫Øt 1 d√≤ng
            const explanationContent = 'NL: Ng∆∞·ªùi l·ªõn | TE: Tr·∫ª em (6-10 tu·ªïi) | DK: Tr·∫ª em ƒëi k√®m (1-5 tu·ªïi) | VeDoan/TuTuc: Lo·∫°i v√© ƒë√£ ƒëƒÉng k√Ω.';

            // Hi·ªÉn th·ªã m√£ QR v√† th√¥ng tin
            qrContainer.innerHTML = `
                <h2>M√£ QR Thanh To√°n</h2>
                <p>T·ªïng ti·ªÅn: **${parseInt(totalAmount).toLocaleString('vi-VN')} VND**</p>
                <p>N·ªôi dung chuy·ªÉn kho·∫£n: **${finalDescription}**</p>
                <img src="${qrUrl}" alt="M√£ QR Thanh To√°n" style="width: 300px; height: 300px;">
                <p class="note">Vui l√≤ng ki·ªÉm tra k·ªπ T·ªïng ti·ªÅn v√† N·ªôi dung tr√™n ·ª©ng d·ª•ng ng√¢n h√†ng.</p>
                
                <div id="explanation">
                    ${explanationContent}
                </div>
            `;
        }

        // --- G·∫Øn s·ª± ki·ªán (Event Listeners) ---
        document.getElementById('transport_mode').addEventListener('change', toggleForms);

        const inputIds = [
            'name', 'group_adults', 'group_children_6_10', 'group_children_1_5',
            'self_adults', 'self_children_6_10', 'self_children_1_5'
        ];
        
        inputIds.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('change', calculateTotal);
                element.addEventListener('input', calculateTotal);
            }
        });

        // Kh·ªüi t·∫°o ban ƒë·∫ßu
        toggleForms();
    </script>
</body>
</html>
